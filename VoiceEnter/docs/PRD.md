# VoiceEnter 产品需求文档 (PRD)

## 文档信息

| 属性 | 值 |
|------|-----|
| 产品名称 | VoiceEnter |
| 版本 | 1.0 |
| 作者 | VoiceEnter Team |
| 更新日期 | 2024-12 |

---

## 1. 产品概述

### 1.1 产品定位

VoiceEnter 是一款 macOS 菜单栏工具，专为语音输入场景设计。通过监听用户输入的触发词，自动执行"删除触发词 + 回车"操作，实现完全免手操作的消息发送体验。

### 1.2 目标用户

| 用户群体 | 使用场景 | 核心诉求 |
|---------|---------|---------|
| 语音输入用户 | 使用 macOS 听写功能输入文字 | 输入完成后无需手动按回车 |
| 终端开发者 | 在 Kitty/Terminal 中执行命令 | 语音输入命令后自动执行 |
| 无障碍用户 | 行动不便，依赖语音操作 | 减少键盘依赖 |
| 效率追求者 | 追求全语音操作流程 | 连续语音操作，不中断 |

### 1.3 产品愿景

> 让语音输入真正解放双手，说完即发，零手动操作。

---

## 2. 需求背景

### 2.1 问题描述

使用 macOS 语音输入（听写功能）时，存在以下痛点：

1. **操作中断** - 语音输入完内容后，必须用手按回车发送
2. **体验割裂** - 语音 → 键盘 → 语音的切换打断流畅体验
3. **效率降低** - 对于需要频繁发送消息的场景，手动回车成为瓶颈
4. **无障碍受限** - 行动不便用户无法完全脱离键盘

### 2.2 解决方案

通过**触发词机制**实现自动回车：

```
用户说: "帮我查一下天气发送"
           └──────────────┴── 触发词

系统执行:
1. 检测到触发词 "发送"
2. 删除 "发送" 两个字符
3. 模拟按下回车键
4. 消息发送成功
```

---

## 3. 功能需求

### 3.1 核心功能

#### F1: 触发词检测

| 需求ID | 描述 | 优先级 |
|-------|------|-------|
| F1.1 | 支持自定义多个触发词 | P0 |
| F1.2 | 支持中文和英文触发词 | P0 |
| F1.3 | 触发词匹配不区分英文大小写 | P1 |
| F1.4 | 触发词后可跟随标点符号（会一并删除） | P1 |
| F1.5 | 触发词长度限制（1-10 字符） | P2 |

**默认触发词：** `发送`、`Go`

**触发词扩展（用户自定义）：**
- `gogogo`
- `发送发送`
- `走你`
- `886`
- `就这样吧`

#### F2: 自动操作

| 需求ID | 描述 | 优先级 |
|-------|------|-------|
| F2.1 | 检测到触发词后，删除触发词字符 | P0 |
| F2.2 | 删除操作包含尾部标点符号 | P1 |
| F2.3 | 删除完成后自动发送回车键 | P0 |
| F2.4 | 防抖处理，避免重复触发（0.5-0.6秒） | P0 |
| F2.5 | 触发后冷却时间，防止连续触发 | P1 |

#### F3: 多场景监听

| 需求ID | 监听模式 | 技术方案 | 优先级 |
|-------|---------|---------|-------|
| F3.1 | Kitty 终端 | `kitty @ get-text` API | P0 |
| F3.2 | Terminal.app | AppleScript | P1 |
| F3.3 | 通用应用 | Accessibility API | P1 |
| F3.4 | 面部表情 | Vision + AVFoundation | P2 |

#### F4: 触发范围控制

| 需求ID | 描述 | 优先级 |
|-------|------|-------|
| F4.1 | 仅 Kitty 模式：只在 Kitty 终端中触发 | P0 |
| F4.2 | 仅终端模式：在 Kitty + Terminal.app 中触发 | P1 |
| F4.3 | 所有应用模式：在任何应用中触发 | P1 |
| F4.4 | 默认使用"仅 Kitty"模式（最安全） | P0 |

### 3.2 界面功能

#### F5: 菜单栏界面

| 需求ID | 描述 | 优先级 |
|-------|------|-------|
| F5.1 | 菜单栏图标，点击展开控制面板 | P0 |
| F5.2 | 启用/禁用监听开关 | P0 |
| F5.3 | 触发词列表展示和管理 | P0 |
| F5.4 | 添加/删除触发词 | P0 |
| F5.5 | 触发范围选择器 | P0 |
| F5.6 | 实时状态显示（监听中/已停止） | P1 |
| F5.7 | 退出应用按钮 | P0 |

#### F6: 视觉设计

| 需求ID | 描述 | 优先级 |
|-------|------|-------|
| F6.1 | 深色主题设计，符合 macOS 风格 | P0 |
| F6.2 | 卡片式布局，信息层级清晰 | P1 |
| F6.3 | 触发词使用标签样式展示 | P1 |
| F6.4 | 状态指示器（绿色/红色圆点） | P1 |
| F6.5 | 悬停动画反馈 | P2 |
| F6.6 | 渐变色调点缀（青色→蓝色） | P2 |

### 3.3 扩展功能

#### F7: 面部表情触发

| 需求ID | 描述 | 优先级 |
|-------|------|-------|
| F7.1 | 支持张嘴表情触发回车 | P2 |
| F7.2 | 支持眨眼表情触发 | P3 |
| F7.3 | 表情灵敏度调节 | P2 |
| F7.4 | 表情触发持续时间要求（防误触） | P2 |
| F7.5 | 表情触发冷却时间 | P2 |

---

## 4. 非功能需求

### 4.1 性能要求

| 指标 | 要求 |
|------|------|
| 触发响应延迟 | < 200ms |
| CPU 占用（空闲） | < 1% |
| CPU 占用（监听中） | < 5% |
| 内存占用 | < 50MB |
| 轮询间隔 | 150-200ms |

### 4.2 兼容性要求

| 项目 | 要求 |
|------|------|
| macOS 版本 | 13.0 (Ventura) 及以上 |
| 架构 | Apple Silicon (arm64) + Intel (x86_64) |
| Kitty 版本 | 支持远程控制的版本 |

### 4.3 安全与隐私

| 项目 | 说明 |
|------|------|
| 数据存储 | 仅存储设置到 UserDefaults，无云端 |
| 权限申请 | 辅助功能（可选）、摄像头（可选） |
| 隐私声明 | 不收集、不上传任何用户数据 |
| 面部数据 | 本地处理，不存储图像 |

---

## 5. 用户故事

### US1: 基础语音发送

> 作为一个语音输入用户，我希望说完内容后说"发送"就能自动发送消息，这样我就不需要用手按回车了。

**验收标准：**
- [ ] 在 Kitty 终端中语音输入 "你好发送"
- [ ] 系统自动删除 "发送" 并按下回车
- [ ] 消息成功发送

### US2: 触发词管理

> 作为一个高级用户，我希望能自定义触发词，这样我可以使用自己习惯的口头禅来触发发送。

**验收标准：**
- [ ] 可以添加新触发词（如 "走你"）
- [ ] 可以删除已有触发词
- [ ] 至少保留一个触发词
- [ ] 新触发词立即生效

### US3: 安全使用

> 作为一个谨慎的用户，我担心在其他应用中误触发，希望能限制触发范围只在终端中生效。

**验收标准：**
- [ ] 可以选择 "仅 Kitty" 模式
- [ ] 在 Kitty 中触发词正常生效
- [ ] 在其他应用中输入触发词不会触发

### US4: 表情触发

> 作为一个喜欢新奇功能的用户，我希望通过做鬼脸（如吐舌头）来触发发送，这样更有趣也更酷。

**验收标准：**
- [ ] 授权摄像头后可启用表情触发
- [ ] 张嘴保持 0.5 秒后触发回车
- [ ] 有冷却时间防止连续触发

---

## 6. 竞品分析

| 产品 | 方案 | 优点 | 缺点 |
|------|------|------|------|
| macOS 语音控制 | 系统级语音命令 | 系统集成 | 需要说"按回车"，不自然 |
| Talon Voice | 语音编程工具 | 功能强大 | 学习成本高，配置复杂 |
| **VoiceEnter** | 触发词监听 | 简单直观、零学习成本 | 需要特定触发词 |

---

## 7. 发布计划

### 7.1 MVP (v1.0)

- [x] Kitty 终端监听
- [x] 触发词检测和自动回车
- [x] 菜单栏 UI
- [x] 触发词管理
- [x] 触发范围控制

### 7.2 v1.1

- [ ] Terminal.app 支持优化
- [ ] 通用应用支持优化
- [ ] 设置持久化
- [ ] 开机自启动

### 7.3 v1.2

- [ ] 面部表情触发
- [ ] 表情设置界面
- [ ] 表情校准功能

### 7.4 v2.0

- [ ] 多语言支持
- [ ] 自定义动作（不只是回车）
- [ ] 快捷键触发
- [ ] 统计数据

---

## 8. 附录

### 8.1 术语表

| 术语 | 定义 |
|------|------|
| 触发词 | 用户说出后触发自动回车的特定词语 |
| 防抖 | 延迟执行，避免文本变化过程中频繁触发 |
| 冷却时间 | 触发后的等待时间，防止连续触发 |
| 轮询 | 定时检查文本内容是否变化 |

### 8.2 参考资料

- [macOS Accessibility API](https://developer.apple.com/documentation/applicationservices/accessibility)
- [Kitty Remote Control](https://sw.kovidgoyal.net/kitty/remote-control/)
- [Apple Vision Framework](https://developer.apple.com/documentation/vision)
