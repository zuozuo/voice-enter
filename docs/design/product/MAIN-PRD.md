# VoiceEnter - Main PRD

| 项目 | 内容 |
|------|------|
| 版本 | v1.1 |
| 作者 | VoiceEnter Team |
| 更新日期 | 2025-12-30 |

---

## 我们要解决什么问题？

使用 macOS 语音输入时，说完内容后必须手动按回车发送，打断了语音操作的流畅体验。
对于躺着编程、手被占用��或行动不便的用户，这个「最后一按」成为无法完全解放双手的障碍。

VoiceEnter 通过关键词触发和面部表情触发两种方式，让用户说完即发，实现真正的零手动操作。

---

## 为谁解决？

| 用户 | 痛点 |
|------|------|
| 语音输入开发者 | 与 AI 编程助手（Claude Code、Cursor）交互时，说完问题还要手动按回车 |
| 特殊姿势用户 | 躺着编程、站立办公、手被占用（吃东西、抱猫）时无法操作键盘 |
| 无障碍用户 | 行动不便，无法完全脱离键盘实现全语音操作 |

---

## 如何验证成功？

| 指标 | 目标 |
|------|------|
| 触发成功率 | > 95%（触发词/表情被正确识别的比例） |
| 误触发率 | < 1%（非预期触发的比例） |
| 响应延迟 | < 200ms（从检测到触发词到执行回车） |

---

## 核心功能

| 功能 | 解决什么问题 | 优先级 | Feature PRD |
|------|-------------|--------|-------------|
| 关键词触发 | 说出触发词（如「发送」）自动删除触发词并按回车，无需手动操作 | P0 | [FEATURE-keyword-trigger](./features/FEATURE-keyword-trigger.md) |
| 多场景监听 | 支持 Kitty、Terminal、通用应用，覆盖不同使用场景 | P0 | [FEATURE-multi-scene-monitor](./features/FEATURE-multi-scene-monitor.md) |
| 表情触发 | 不方便说话时，通过面部表情（张嘴、撅嘴等）触发回车 | P1 | [FEATURE-expression-trigger](./features/FEATURE-expression-trigger.md) |
| 触发范围控制 | 限制触发生效范围，避免在不需要的应用中误触发 | P1 | [FEATURE-trigger-scope](./features/FEATURE-trigger-scope.md) |
| 触发音效反馈 | 触发时播放音效，提供明确的操作反馈 | P2 | [FEATURE-trigger-sound](./features/FEATURE-trigger-sound.md) |

---

## 产品架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        VoiceEnter App                           │
│                      (macOS 菜单栏应用)                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    触发检测层                            │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────────┐  │   │
│  │  │ 关键词触发   │  │  表情触发   │  │   触发范围控制   │  │   │
│  │  │ TriggerWord │  │ Expression  │  │   TriggerScope  │  │   │
│  │  │  Detector   │  │   Monitor   │  │                 │  │   │
│  │  └──────┬──────┘  └──────┬──────┘  └────────┬────────┘  │   │
│  └─────────┼────────────────┼──────────────────┼───────────┘   │
│            │                │                  │               │
│  ┌─────────┼────────────────┼──────────────────┼───────────┐   │
│  │         v                v                  v            │   │
│  │                    输入监听层                            │   │
│  │  ┌─────────────────────────────────────────────────┐    │   │
│  │  │           UniversalInputMonitor                  │    │   │
│  │  │                 (监听协调器)                      │    │   │
│  │  └─────────────────────────────────────────────────┘    │   │
│  │         │                │                │              │   │
│  │         v                v                v              │   │
│  │  ┌───────────┐   ┌───────────┐   ┌─────────────────┐    │   │
│  │  │  Kitty    │   │ Terminal  │   │   TextMonitor   │    │   │
│  │  │  Monitor  │   │  Monitor  │   │  (Accessibility)│    │   │
│  │  └─────┬─────┘   └─────┬─────┘   └────────┬────────┘    │   │
│  └────────┼───────────────┼──────────────────┼─────────────┘   │
│           │               │                  │                 │
│           v               v                  v                 │
│  ┌────────────────────────────────────────────────────────┐    │
│  │                     外部接口层                          │    │
│  │  kitty @ get-text    AppleScript      AXUIElement API  │    │
│  └────────────────────────────────────────────────────────┘    │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                      输出执行层                          │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────────┐  │   │
│  │  │ KeySimulator│  │ SoundPlayer │  │ SettingsManager │  │   │
│  │  │  (CGEvent)  │  │  (NSSound)  │  │  (UserDefaults) │  │   │
│  │  └─────────────┘  └─────────────┘  └─────────────────┘  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘

外部依赖：
┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐
│   Vision    │  │AVFoundation │  │Accessibility│  │   AppKit    │
│  (人脸检测)  │  │  (摄像头)   │  │   (文本)    │  │   (UI)      │
└─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘
```

### 数据流

```
用户输入 ──┬──> 语音转文字 ──> 文本监听器 ──> 触发词检测 ──┬──> 删除触发词
           │                                              │
           │                                              ├──> 模拟回车
           │                                              │
           └──> 摄像头捕获 ──> 表情检测 ─────────────────>├──> 播放音效
                                                          │
                                                          v
                                                      操作完成
```

### 核心组件

| 组件 | 职责 | 技术 |
|------|------|------|
| UniversalInputMonitor | 协调多个监听器 | Swift |
| KittyTerminalMonitor | 监听 Kitty 终端文本 | kitty 远程 API |
| TerminalAppMonitor | 监听 Terminal.app 文本 | AppleScript |
| TextMonitor | 监听通用应用文本 | Accessibility API |
| FaceExpressionMonitor | 检测面部表情 | Vision + AVFoundation |
| TriggerWordDetector | 检测触发词 | 正则匹配 |
| KeySimulator | 模拟键盘操作 | CGEvent API |
| SettingsManager | 管理用户设置 | UserDefaults |

---

## 技术选型

| 方面 | 选择 | 原因 |
|------|------|------|
| 语言 | Swift 5.9 | macOS 原生开发，性能优秀 |
| UI 框架 | SwiftUI | 现代声明式 UI，菜单栏应用简洁 |
| 最低系统 | macOS 13.0+ | Vision 框架需要，覆盖主流用户 |
| 架构模式 | MVVM + Observer | 状态管理清晰，响应式更新 |
| 人脸检测 | Vision | Apple 原生框架，无需额外依赖 |
| 摄像头 | AVFoundation | 系统级摄像头访问 |
| 按键模拟 | CGEvent | 系统级按键事件，兼容性好 |

---

## 权限需求

| 权限 | 用途 | 必需 |
|------|------|------|
| 辅助功能 | TextMonitor 读取文本、KeySimulator 模拟按键 | 是 |
| 摄像头 | FaceExpressionMonitor 面部检测 | 否（仅表情触发需要） |

---

## 关联文档

- [架构设计文档](../../architecture/Architecture.md)
- [Feature PRDs](./features/)
